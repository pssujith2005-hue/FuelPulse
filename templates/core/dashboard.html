{% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
    /* --- SASSY DASHBOARD THEME --- */
    :root {
        --bg-deep: #000000;
        --card-bg: #0a0a0a;
        --glass-border: rgba(255, 255, 255, 0.1);
        --accent-gradient: linear-gradient(135deg, #06b6d4 0%, #8b5cf6 100%);
        --text-glow: linear-gradient(90deg, #22d3ee, #c084fc);
    }

    /* Override Base Styles */
    body, .main-content {
        background-color: var(--bg-deep) !important;
        color: white;
        font-family: 'Outfit', sans-serif;
        overflow-x: hidden;
    }

    /* Gradient Text Utility */
    .gradient-text {
        background: var(--text-glow);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        font-weight: 800;
        display: inline-block;
    }

    /* Page Header */
    .page-header h2 { font-weight: 900; letter-spacing: -1px; margin-bottom: 5px; font-size: 2.2rem; }
    .page-header p { font-size: 0.95rem; color: #94a3b8; }

    /* --- CARDS --- */
    .stats-card {
        background: var(--card-bg);
        border: 1px solid var(--glass-border);
        border-radius: 20px;
        padding: 1.8rem;
        position: relative;
        overflow: hidden;
        transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        backdrop-filter: blur(10px);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    .stats-card:hover {
        transform: translateY(-5px) scale(1.01);
        border-color: #3b82f6;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4), 0 0 30px rgba(59, 130, 246, 0.2);
    }

    /* Glowing Border Effect */
    .stats-card::before {
        content: '';
        position: absolute;
        top: 0; left: 0; width: 100%; height: 3px;
        background: var(--accent-gradient);
        opacity: 0.7;
        transition: 0.4s;
    }
    .stats-card:hover::before {
        opacity: 1;
        width: 100%;
        background: linear-gradient(90deg, #ffffff, #3b82f6, #1e3a8a);
    }

    /* Stats Labels */
    .stats-label h3 { 
        font-size: 0.75rem; 
        text-transform: uppercase; 
        letter-spacing: 2px; 
        color: #94a3b8; 
        margin-bottom: 12px; 
        font-weight: 700; 
    }
    .stats-label h1 { 
        font-size: 3.5rem;
        font-weight: 800; 
        margin-bottom: 5px; 
        line-height: 1;
        color: white;
    }

    /* --- VEHICLE CARDS --- */
    .vehicle-card {
        padding: 0; 
        border-radius: 20px;
    }
    .vehicle-img-container {
        height: 180px;
        width: 100%;
        background-size: cover; 
        background-position: center;
        background-repeat: no-repeat;
        position: relative;
        transition: transform 0.6s ease;
    }
    .stats-card:hover .vehicle-img-container {
        transform: scale(1.03);
    }
    .vehicle-img-container::after {
        content: ''; position: absolute; inset: 0;
        background: linear-gradient(to bottom, transparent 40%, #0a0a0a 100%);
    }

    /* --- BUTTONS --- */
    .btn-sassy {
        background: var(--accent-gradient);
        border: none;
        color: white;
        font-weight: 700;
        padding: 10px 25px;
        border-radius: 12px;
        transition: 0.3s;
        box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
    }
    .btn-sassy:hover {
        opacity: 0.95;
        transform: translateY(-2px);
        color: white;
        box-shadow: 0 6px 20px rgba(6, 182, 212, 0.5);
    }

    .btn-sassy-outline {
        background: transparent;
        border: 1px solid rgba(255,255,255,0.2);
        color: #cbd5e1;
        font-weight: 600;
        padding: 12px;
        border-radius: 12px;
        transition: 0.3s;
        display: flex;
        align-items: center;
        justify-content: center; /* Center content for better alignment */
        width: 100%; /* Ensure full width in grid */
        text-align: left; /* Align text left inside */
        justify-content: flex-start; /* Revert back to left align content */
    }
    .btn-sassy-outline:hover {
        border-color: white;
        color: white;
        background: rgba(255,255,255,0.05);
        box-shadow: 0 0 15px rgba(59, 130, 246, 0.2);
    }

    /* Activity List Items */
    .activity-item {
        transition: 0.3s;
        padding: 12px;
        border-radius: 16px;
        background: rgba(255,255,255,0.02);
        border: 1px solid transparent;
        margin-bottom: 10px;
    }
    .activity-item:hover {
        background: rgba(255,255,255,0.05);
        border-color: rgba(59, 130, 246, 0.3);
        transform: translateX(5px);
    }

    /* Dropdown Z-Index Fix */
    .dropdown-menu-dark {
        background-color: #050505;
        border: 1px solid var(--glass-border);
        box-shadow: 0 20px 50px rgba(0,0,0,0.9);
        z-index: 1055 !important;
    }
    .dropdown-item:hover { 
        background: linear-gradient(90deg, #1e3a8a, transparent); 
        color: white; 
    }
    
    /* Logo Badge */
    .card-logo-badge {
        position: absolute;
        right: 25px;
        top: 50%;
        transform: translateY(-50%);
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: linear-gradient(145deg, #000000, #111111);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 
            5px 5px 15px rgba(0,0,0,0.5), 
            -1px -1px 10px rgba(255,255,255,0.05),
            inset 0 0 20px rgba(0,0,0,0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.4s ease;
        z-index: 2;
    }

    .card-logo-badge i {
        font-size: 2.5rem;
        background: linear-gradient(180deg, #ffffff 0%, #3b82f6 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        filter: drop-shadow(0 0 5px rgba(59, 130, 246, 0.5));
        transition: transform 0.4s ease;
    }

    .stats-card:hover .card-logo-badge {
        border-color: #3b82f6;
        box-shadow: 0 0 25px rgba(59, 130, 246, 0.3);
        transform: translateY(-50%) scale(1.1);
    }
    .stats-card:hover .card-logo-badge i {
        transform: scale(1.1);
    }

    /* Modal Inputs (Black bg, White text) */
    .modal-content {
        background-color: #000000;
        border: 1px solid rgba(255,255,255,0.2);
    }
    .modal-header, .modal-footer {
        border-color: rgba(255,255,255,0.1);
        background-color: #050505 !important;
    }
    .form-control, .form-select {
        background-color: #000000 !important;
        border: 1px solid rgba(255, 255, 255, 0.2) !important;
        color: #ffffff !important;
        border-radius: 12px;
        padding: 10px 15px;
    }
    .form-control:focus, .form-select:focus {
        border-color: #8b5cf6 !important;
        box-shadow: 0 0 10px rgba(139, 92, 246, 0.2) !important;
        background-color: #000000 !important;
        color: white !important;
    }
    /* Ensure dropdown options are black background with white font */
    select option {
        background-color: #000000;
        color: #ffffff;
    }
    
    /* Animation */
    .fade-in-up {
        animation: fadeInUp 0.8s ease-out forwards;
        opacity: 0;
        transform: translateY(20px);
    }
    @keyframes fadeInUp {
        to { opacity: 1; transform: translateY(0); }
    }
</style>

<!-- HEADER SECTION -->
<div class="d-flex justify-content-between align-items-end mb-5 fade-in-up" 
     style="animation-duration: 0.6s; position: relative; z-index: 1050;">
    <div class="page-header">
        <h2 class="text-white">My Garage</h2>
        <p class="text-white-50">Monitor your vehicles, trips, and fuel consumption.</p>
    </div>
    
    <div class="d-flex gap-3 align-items-center">
        <!-- NOTIFICATION BELL -->
        <div class="dropdown">
            <a href="#" class="btn btn-dark border border-secondary rounded-circle d-flex align-items-center justify-content-center position-relative shadow-sm" 
               id="dashboardNotifyDropdown" 
               data-bs-toggle="dropdown" 
               aria-expanded="false" 
               style="width: 45px; height: 45px; background: #000; transition: 0.3s;">
                
                <i class="fas fa-bell text-white"></i>
                {% if notification_count > 0 %}
                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger shadow-sm" style="font-size: 0.6rem; border: 2px solid #000;">
                    {{ notification_count }}
                </span>
                {% endif %}
            </a>

            <ul class="dropdown-menu dropdown-menu-end dropdown-menu-dark shadow-lg" aria-labelledby="dashboardNotifyDropdown" style="width: 320px;">
                <li><h6 class="dropdown-header text-uppercase text-muted small fw-bold letter-spacing-1">Alerts</h6></li>
                <li><hr class="dropdown-divider border-secondary opacity-25"></li>
                {% if notifications %}
                    {% for n in notifications %}
                    <li>
                        <a class="dropdown-item d-flex align-items-start gap-3 py-3" href="#">
                            <div class="mt-1">
                                {% if n.type == 'danger' %} <div class="bg-danger bg-opacity-25 rounded-circle p-2"><i class="fas fa-exclamation-circle text-danger"></i></div>
                                {% elif n.type == 'warning' %} <div class="bg-warning bg-opacity-25 rounded-circle p-2"><i class="fas fa-clock text-warning"></i></div>
                                {% else %} <div class="bg-info bg-opacity-25 rounded-circle p-2"><i class="fas fa-info-circle text-info"></i></div> {% endif %}
                            </div>
                            <div style="white-space: normal; line-height: 1.4;">
                                <small class="d-block text-white fw-medium">{{ n.msg }}</small>
                            </div>
                        </a>
                    </li>
                    {% endfor %}
                {% else %}
                    <li><div class="text-muted small text-center py-4 opacity-75">No new alerts</div></li>
                {% endif %}
            </ul>
        </div>

        <!-- ADD VEHICLE BUTTON -->
        <a href="{% url 'add_vehicle' %}" class="btn-sassy d-flex align-items-center gap-2 px-4 rounded-pill text-decoration-none" style="height: 45px;">
            <i class="fas fa-plus"></i> <span class="d-none d-md-inline">Add Vehicle</span>
        </a>
        
        <!-- PROFILE AVATAR -->
        <a href="{% url 'profile' %}" class="btn btn-dark border border-secondary rounded-circle d-flex align-items-center justify-content-center ms-2 text-decoration-none shadow-sm" style="width: 45px; height: 45px; background-color: #000; transition: 0.3s;">
            {% if user.profile_photo %}
            <img src="{{ user.profile_photo.url }}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">
            {% else %}
            <span class="gradient-text">{{ user.username|slice:":1"|upper }}</span>
            {% endif %}
        </a>
    </div>
</div>

<!-- TOP STATS ROW -->
<div class="row g-4 mb-5">
    <!-- Card 1: Active Vehicles -->
    <div class="col-md-4">
        <div class="stats-card h-100 position-relative overflow-hidden fade-in-up" style="animation-delay: 0.1s;">
            <div class="stats-label position-relative z-1">
                <h3>Active vehicles</h3>
                <h1 class="gradient-text">{{ vehicle_count }}</h1>
                <p class="text-white small">
                    {% if vehicle_count == 0 %}Start by adding a vehicle.{% else %}Vehicles in garage.{% endif %}
                </p>
            </div>
            <div class="card-logo-badge">
                <i class="fas fa-car-side"></i>
            </div>
        </div>
    </div>
    
    <!-- Card 2: Fuel -->
    <div class="col-md-4">
        <div class="stats-card h-100 position-relative overflow-hidden fade-in-up" style="animation-delay: 0.2s;">
            <div class="stats-label position-relative z-1">
                <h3>Fuel Used (Month)</h3>
                <h1 class="gradient-text">{{ total_fuel }} <span class="fs-4 text-white">L</span></h1>
                <p class="text-white small">
                    {% if total_fuel == 0 %}No logs recorded yet.{% else %}Consumed this month.{% endif %}
                </p>
            </div>
            <div class="card-logo-badge">
                <i class="fas fa-gas-pump"></i>
            </div>
        </div>
    </div>
    
    <!-- Card 3: Distance -->
    <div class="col-md-4">
        <div class="stats-card h-100 position-relative overflow-hidden fade-in-up" style="animation-delay: 0.3s;">
            <div class="stats-label position-relative z-1">
                <h3>Total Distance</h3>
                <h1 class="gradient-text">{{ total_distance }} <span class="fs-4 text-white">km</span></h1>
                <p class="text-white small">
                    {% if total_distance == 0 %}Start a trip to see data.{% else %}Lifetime distance logged.{% endif %}
                </p>
            </div>
            <div class="card-logo-badge">
                <i class="fas fa-route"></i>
            </div>
        </div>
    </div>
</div>

<!-- MAIN CONTENT GRID -->
<div class="row g-4">
    
    <!-- LEFT COLUMN: GARAGE -->
    <div class="col-lg-8">
        <div class="d-flex justify-content-between align-items-center mb-4 fade-in-up" style="animation-delay: 0.4s;">
            <div class="text-uppercase small fw-bold text-muted letter-spacing-1"><i class="fas fa-warehouse me-2 text-info"></i> Garage Overview</div>
        </div>

        <div class="row g-4">
            {% if vehicles %}
                {% for v in vehicles %}
                <div class="col-md-6 fade-in-up" style="animation-delay: 0.5s;">
                      <!-- Vehicle Card -->
                      <div class="stats-card vehicle-card h-100 overflow-hidden">
                        <!-- SMART IMAGE HEADER -->
                        <div style="overflow: hidden;"> <!-- Wrapper for scale animation -->
                            <div class="vehicle-img-container" style="background-image: url('{% if 'Two' in v.category|stringformat:'s' %}https://images.unsplash.com/photo-1558981806-ec527fa84c3d?q=80&w=600&auto=format&fit=crop{% else %}https://images.unsplash.com/photo-1492144534655-ae79c964c9d7?q=80&w=600&auto=format&fit=crop{% endif %}');">
                            </div>
                        </div>
                        
                        <div class="p-4">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div>
                                    <h5 class="fw-bold text-white mb-1">{{ v.make }} {{ v.model_name }}</h5>
                                    
                                    <div class="d-flex align-items-center gap-2 mb-2">
                                        <small class="text-white border border-secondary px-2 rounded-pill bg-black" style="font-size: 0.7rem; letter-spacing: 0.5px;">{{ v.license_plate }}</small>
                                        {% if 'Two' in v.category|stringformat:'s' %}
                                            <i class="fas fa-motorcycle text-secondary small"></i>
                                        {% else %}
                                            <i class="fas fa-car text-secondary small"></i>
                                        {% endif %}
                                    </div>

                                    <div class="text-muted small" style="font-size: 0.8rem; color: #cbd5e1 !important;">
                                        <i class="fas fa-calendar-alt me-1 text-info"></i> 
                                        Reg: <span class="text-white">{{ v.purchase_year }}</span>
                                    </div>
                                </div>
                                
                                <div class="d-flex gap-2">
                                    <span class="badge bg-black border border-secondary text-secondary d-flex align-items-center px-3">{{ v.ownership_type }}</span>
                                    <a href="{% url 'remove_vehicle' v.id %}" class="btn btn-outline-danger btn-sm px-2 border-0" onclick="return confirm('Delete vehicle?');"><i class="fas fa-trash-alt"></i></a>
                                </div>
                            </div>

                            <div class="fs-4 fw-bold mb-4 text-white">
                                {{ v.current_odometer }} <span class="fs-6 text-muted fw-normal" style="color: #cbd5e1 !important;">km</span>
                            </div>
                            
                            <div class="d-grid gap-2">
                                <a href="{% url 'log_fuel' v.id %}" class="btn-sassy-outline text-white"><i class="fas fa-gas-pump me-2 text-success"></i> Log Fuel</a>
                                <a href="{% url 'vehicle_stats' v.id %}" class="btn-sassy-outline text-white"><i class="fas fa-chart-line me-2 text-info"></i> View Stats</a>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                 <!-- Empty State -->
                 <div class="col-12 fade-in-up" style="animation-delay: 0.5s;">
                    <div class="stats-card p-5 text-center border-secondary border-dashed bg-transparent" style="border-style: dashed; border-width: 2px;">
                        <div class="rounded-circle bg-dark d-inline-flex p-4 mb-3 border border-secondary">
                            <i class="fas fa-car fa-3x text-muted opacity-50"></i>
                        </div>
                        <h5 class="text-white fw-bold">Garage is Empty</h5>
                        <p class="text-muted mb-4" style="color: #e2e8f0 !important;">Add your first vehicle to start tracking costs.</p>
                        <a href="{% url 'add_vehicle' %}" class="btn-sassy px-5 py-2 rounded-pill text-decoration-none">Add Vehicle</a>
                    </div>
                 </div>
            {% endif %}

            <!-- RECOMMENDATION ENGINE BUTTON -->
            <div class="col-12 fade-in-up" style="animation-delay: 0.6s;">
                <div class="d-grid">
                    <a href="{% url 'recommend_car' %}" class="btn-sassy-outline d-flex align-items-center justify-content-center gap-3 py-3" style="border-style: dashed; border-width: 2px;">
                        <i class="fas fa-search-plus fs-4 text-info"></i>
                        <span class="text-white fw-bold">Looking for a new ride? Try our Recommendation Engine</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- RIGHT COLUMN: QUICK ACTIONS & ACTIVITY -->
    <div class="col-lg-4">
        <div class="stats-card h-100 fade-in-up" style="animation-delay: 0.6s;">
            <h5 class="fw-bold mb-4 text-white border-bottom border-secondary pb-3 text-uppercase small letter-spacing-1">Quick Actions</h5>
            
            <div class="d-grid gap-3 mb-5">
                <a href="{% url 'log_trip' %}" class="btn-sassy text-start px-4 text-white py-3 rounded-3 position-relative overflow-hidden text-decoration-none">
                    <span class="position-relative z-1"><i class="fas fa-play-circle me-3 fs-5"></i> Start Quick Trip</span>
                    <i class="fas fa-arrow-right position-absolute end-0 me-3 opacity-50"></i>
                </a>
                <a href="{% url 'trip_calculator' %}" class="btn-sassy-outline text-start px-3 text-light py-3 rounded-3">
                    <i class="fas fa-calculator me-3 text-info"></i> Estimate Trip Cost
                </a>
                <button type="button" class="btn-sassy-outline text-start px-3 text-light py-3 rounded-3" data-bs-toggle="modal" data-bs-target="#valuationModal">
                    <i class="fas fa-sack-dollar me-3 text-success"></i> Estimate Asset Value
                </button>
                <a href="{% url 'recommend_car' %}" class="btn-sassy-outline text-start px-3 text-light py-3 rounded-3">
                    <i class="fas fa-car-side me-3 text-warning"></i> Find New Car
                </a>
            </div>

            <h6 class="text-muted small text-uppercase fw-bold mb-4 letter-spacing-1" style="color: #e2e8f0 !important;">Recent Activity</h6>
            <div class="activity-list">
                <!-- Activity Item 1 -->
                <div class="d-flex gap-3 mb-4 activity-item">
                    <div class="text-center" style="width: 20px;">
                        <div class="rounded-circle bg-dark border border-secondary d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
                            <i class="fas fa-road text-muted" style="font-size: 12px;"></i>
                        </div>
                        <div class="h-100 border-start border-secondary border-opacity-25 mx-auto my-1"></div>
                    </div>
                    <div class="ps-2">
                        <div class="text-white small fw-bold">No recent trips</div>
                        <div class="text-white small" style="font-size: 0.8rem; color: #cbd5e1 !important;">Your timeline is empty.</div>
                    </div>
                </div>
                <!-- Activity Item 2 -->
                <div class="d-flex gap-3 activity-item">
                    <div class="text-center" style="width: 20px;">
                        <div class="rounded-circle bg-dark border border-secondary d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
                            <i class="fas fa-wrench text-muted" style="font-size: 12px;"></i>
                        </div>
                    </div>
                    <div class="ps-2">
                        <div class="text-white small fw-bold">Maintenance</div>
                        <div class="text-white small" style="font-size: 0.8rem; color: #cbd5e1 !important;">No service history available.</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- VALUATION MODAL (Updated Sassy Style) -->
<div class="modal fade" id="valuationModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-black border border-secondary text-white shadow-lg" style="border-radius: 20px; overflow: hidden; box-shadow: 0 0 50px rgba(0,0,0,0.9);">
            <div class="modal-header border-secondary bg-dark">
                <h5 class="modal-title fw-bold"><i class="fas fa-chart-line text-success me-2"></i> Asset Estimator</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form method="post" action="{% url 'calculate_value' %}">
                {% csrf_token %}
                <div class="modal-body p-4">
                    <p class="text-muted small mb-4" style="color: #cbd5e1 !important;">Calculate real-time market value based on detailed condition.</p>
                    
                    <!-- Vehicle Select -->
                    <div class="mb-3">
                        <label class="small text-muted mb-1" style="color: #94a3b8 !important;">Select Vehicle</label>
                        <select name="vehicle_id" class="form-select bg-black text-white border-secondary">
                            {% for car in vehicles %}
                                <option value="{{ car.id }}">{{ car.make }} {{ car.model_name }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Ownership Select -->
                    <div class="mb-3">
                        <label class="small text-muted mb-1" style="color: #94a3b8 !important;">Ownership History</label>
                        <select name="ownership" class="form-select bg-black text-white border-secondary">
                            <option value="1.0">1st Owner (Direct)</option>
                            <option value="0.9">2nd Owner</option>
                            <option value="0.8">3rd Owner</option>
                            <option value="0.7">4th Owner</option>
                            <option value="0.6">5th Owner</option>
                        </select>
                    </div>

                    <!-- Condition & Maintenance Grid -->
                    <div class="row g-2">
                         <!-- Tyre Condition -->
                        <div class="col-12 mb-2">
                             <label class="small text-muted mb-1" style="color: #94a3b8 !important;">Tyre Condition</label>
                             <div class="btn-group w-100" role="group">
                                <input type="radio" class="btn-check" name="tyres" id="t1" value="1.0" checked>
                                <label class="btn btn-outline-secondary btn-sm" for="t1">Good</label>
            
                                <input type="radio" class="btn-check" name="tyres" id="t2" value="0.95">
                                <label class="btn btn-outline-secondary btn-sm" for="t2">Avg</label>
            
                                <input type="radio" class="btn-check" name="tyres" id="t3" value="0.90">
                                <label class="btn btn-outline-secondary btn-sm" for="t3">Rough</label>
                            </div>
                        </div>

                         <!-- Maintenance History -->
                         <div class="col-12 mb-2">
                            <label class="small text-muted mb-1" style="color: #94a3b8 !important;">Service History</label>
                            <div class="btn-group w-100" role="group">
                               <input type="radio" class="btn-check" name="maintenance" id="m1" value="1.05" checked>
                               <label class="btn btn-outline-secondary btn-sm" for="m1">Timely</label>
           
                               <input type="radio" class="btn-check" name="maintenance" id="m2" value="1.0">
                               <label class="btn btn-outline-secondary btn-sm" for="m2">Avg</label>
           
                               <input type="radio" class="btn-check" name="maintenance" id="m3" value="0.85">
                               <label class="btn btn-outline-secondary btn-sm" for="m3">Poor</label>
                           </div>
                       </div>
                    </div>

                    <!-- Overall Condition -->
                    <div class="mb-3 mt-2">
                        <label class="small text-muted mb-1" style="color: #94a3b8 !important;">Overall Condition</label>
                        <div class="btn-group w-100" role="group">
                            <input type="radio" class="btn-check" name="condition" id="c1" value="1.0" checked>
                            <label class="btn btn-outline-secondary btn-sm" for="c1">Excellent</label>

                            <input type="radio" class="btn-check" name="condition" id="c2" value="0.9">
                            <label class="btn btn-outline-secondary btn-sm" for="c2">Good</label>

                            <input type="radio" class="btn-check" name="condition" id="c3" value="0.75">
                            <label class="btn btn-outline-secondary btn-sm" for="c3">Rough</label>
                        </div>
                    </div>
                </div>
                <!-- MODAL FOOTER -->
                <div class="modal-footer border-secondary pt-4 pb-4 px-4 bg-dark">
                    <button type="submit" class="btn-sassy w-100">
                        <i class="fas fa-calculator me-2"></i> Calculate Exact Value
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- RESULT MODAL -->
{% if valuation_result %}
<script>
    document.addEventListener("DOMContentLoaded", function() {
        new bootstrap.Modal(document.getElementById('valueResultModal')).show();
    });
</script>
<div class="modal fade" id="valueResultModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-black border border-success text-center" style="border-radius: 20px; box-shadow: 0 0 50px rgba(16, 185, 129, 0.2);">
            <div class="modal-body p-5">
                <i class="fas fa-coins fa-4x text-success mb-4" style="filter: drop-shadow(0 0 10px rgba(16, 185, 129, 0.5));"></i>
                <h5 class="text-muted text-uppercase small letter-spacing-1" style="color: #cbd5e1 !important;">Estimated Value</h5>
                <h1 class="display-3 fw-bold text-white mb-2">â‚¹ {{ valuation_result }}</h1>
                <p class="text-white-50 mb-4">for {{ valuation_vehicle }}</p>
                <button type="button" class="btn btn-success w-100 fw-bold py-3 rounded-pill" data-bs-dismiss="modal">Done</button>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- NOTIFICATION SCRIPT (Manual Override) -->
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const bellBtn = document.getElementById('dashboardNotifyDropdown');
        const dropdownMenu = bellBtn.nextElementSibling; 
    
        bellBtn.addEventListener('click', function(event) {
            event.preventDefault();
            event.stopPropagation(); 
            if (dropdownMenu.style.display === 'block') {
                dropdownMenu.style.display = 'none';
                dropdownMenu.classList.remove('show');
            } else {
                dropdownMenu.style.display = 'block';
                dropdownMenu.classList.add('show');
                dropdownMenu.style.position = 'absolute';
                dropdownMenu.style.inset = '0px 0px auto auto';
                dropdownMenu.style.transform = 'translate(0px, 50px)';
            }
        });
        document.addEventListener('click', function(event) {
            if (!bellBtn.contains(event.target) && !dropdownMenu.contains(event.target)) {
                dropdownMenu.style.display = 'none';
                dropdownMenu.classList.remove('show');
            }
        });
        
        // Enforce dark theme selects
        const selects = document.querySelectorAll('select');
        selects.forEach(select => {
            select.style.backgroundImage = `url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23ffffff' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e")`;
            select.style.backgroundRepeat = 'no-repeat';
            select.style.backgroundPosition = 'right 0.75rem center';
            select.style.backgroundSize = '16px 12px';
            select.style.appearance = 'none'; 
        });
    });
</script>

{% endblock %}